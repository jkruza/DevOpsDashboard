@{
    ViewBag.Title = "DevOps Dashboard";
}



<div class="row" id="lists">
    <div class="col-md-8"><ul id="list"></ul></div>
    <div class="col-md-4"><div id="blist"></div></div>
</div>



@section scripts {
    
    <!--Script references. -->
    <!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
    <!--Reference the SignalR library. -->
    <script src="~/Scripts/jquery.signalR-2.2.2.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <!--SignalR script to update the chat page and send messages.-->
    <script>
        $(function () {
            // Reference the auto-generated proxy for the hub.
            var dashboard = $.connection.dashboardMessageHub;
            // Create a function that the hub can call back to display messages.
            dashboard.client.broadcastDashboardMessage = function (jsonString) {
                if (typeof jsonString  == "string")
                { var json = JSON.parse(jsonString); }
                else {
                    var json = jsonString;
                }
                var str = JSON.stringify(json, null, 2);
              
                switch (json.Category) {

                    case "Release":
                    case "Build":
                        var m = json.Message;
                        var t = json.Title;
                        var cls = "";
                        var s = json.Status;
                        switch (s)
                        {
                            case "succeeded": 
                            case "success":
                                cls = "alert-success";
                                break;

                            case "failed":
                            case "rejected":
                                cls = "alert-danger";
                                break;
                        }

                        $("#blist").append('<div class="alert '+cls+'"><strong>' + t+"</strong><p>" +m+ "</p></div>");
                        while ($("#blist").children().length > 20) {
                            $('#blist div:eq(0)').remove();
                        }
                        break;

                    default:
                        var s = json.Message;
                         $("#list").append("<li>" + s + "</li>");
                        while ($("#list").children().length > 20) {
                            $('#list div:eq(0)').remove();
                        }

                }
            };

            $.connection.hub.start().done(function () {

            });
        });

    </script>
}